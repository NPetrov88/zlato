{% extends 'products/base.html' %}
{% load i18n %}

{% block title %}{{ product.name }} - ZLATO{% endblock %}

{% block content %}
<section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Breadcrumb -->
    <nav class="mb-8 fade-in">
        <ol class="flex items-center space-x-2 text-sm">
            <li><a href="{% url 'homepage' %}" class="text-zlato-black/60 hover:text-zlato-lime transition">{% trans "Shop" %}</a></li>
            <li class="text-zlato-black/40">/</li>
            <li class="text-zlato-black font-semibold">{{ product.name }}</li>
        </ol>
    </nav>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
        <!-- Product Images -->
        <div class="fade-in">
            <!-- Main Image -->
            <div class="bg-zlato-pink rounded-2xl overflow-hidden mb-4 aspect-square flex items-center justify-center">
                {% if product.image %}
                    <img id="mainImage" src="{% static product.image.name %}" alt="{{ product.name }}"
                         class="w-full h-full object-cover transition-transform duration-500 hover:scale-110">
                {% else %}
                    <div class="text-zlato-black/30 text-center p-8">
                        <svg class="w-32 h-32 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                        <p>{% trans "No image" %}</p>
                    </div>
                {% endif %}
            </div>

            <!-- Gallery Thumbnails -->
            {% if gallery_images %}
            <div class="grid grid-cols-3 sm:grid-cols-4 gap-3 sm:gap-4">
                {% for img in gallery_images %}
                <button onclick="changeImage('{{ img.image.url }}')"
                        class="bg-zlato-pink-light rounded-lg overflow-hidden aspect-square hover:ring-4 hover:ring-zlato-lime transition">
                    <img src="{{ img.image.url }}" alt="{{ img.alt_text }}" class="w-full h-full object-cover">
                </button>
                {% endfor %}
            </div>
            {% endif %}
        </div>

        <!-- Product Info -->
        <div class="fade-in">
            <!-- Product Type Badge -->
            {% if product.product_type %}
            <div class="inline-block bg-zlato-lime/20 text-zlato-black border-2 border-zlato-lime px-4 py-1 rounded-full text-sm font-bold mb-4">
                {{ product.get_product_type_display }}
            </div>
            {% endif %}

            <!-- Product Name -->
            <h1 class="text-5xl font-black text-zlato-black mb-4 leading-tight">
                {% if language == 'bg' and product.name_bg %}
                    {{ product.name_bg }}
                {% else %}
                    {{ product.name }}
                {% endif %}
            </h1>

            <!-- Short Description -->
            {% if product.short_description or product.short_description_bg %}
            <p class="text-xl text-zlato-black/70 font-semibold mb-6">
                {% if language == 'bg' and product.short_description_bg %}
                    {{ product.short_description_bg }}
                {% else %}
                    {{ product.short_description }}
                {% endif %}
            </p>
            {% endif %}

            <!-- Price -->
            <div class="mb-8">
                <span class="text-5xl font-black text-zlato-black">{{ product.price }}</span>
                <span class="text-2xl font-bold text-zlato-black/70"> EUR</span>
            </div>

            <!-- Stock Status -->
            {% if product.in_stock %}
            <div class="flex items-center gap-2 mb-6">
                <div class="w-3 h-3 bg-zlato-lime rounded-full animate-pulse"></div>
                <span class="font-semibold text-zlato-black">{% trans "In Stock" %}</span>
            </div>
            {% else %}
            <div class="flex items-center gap-2 mb-6">
                <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
                <span class="font-semibold text-gray-500">{% trans "Out of Stock" %}</span>
            </div>
            {% endif %}

            <!-- Add to Cart Form -->
            <div class="mb-8" x-data="{ quantity: 1 }">
                {% if product.in_stock %}
                <form method="post" action="{% url 'cart:add' product.id %}" @submit="$dispatch('cart-updated')" class="space-y-4">
                    {% csrf_token %}

                    <!-- Quantity Selector -->
                    <div class="flex items-center gap-4">
                        <label class="font-bold text-zlato-black">{% trans "Quantity" %}:</label>
                        <div class="flex items-center border-2 border-zlato-black rounded-lg overflow-hidden">
                            <button type="button" @click="quantity = Math.max(1, quantity - 1)"
                                    class="px-4 py-2 bg-zlato-pink-light hover:bg-zlato-pink transition font-bold">
                                -
                            </button>
                            <input type="number" name="quantity" x-model="quantity" min="1" max="{{ product.inventory }}"
                                   class="w-20 text-center border-none font-bold text-lg focus:outline-none">
                            <button type="button" @click="quantity = Math.min({{ product.inventory }}, quantity + 1)"
                                    class="px-4 py-2 bg-zlato-pink-light hover:bg-zlato-pink transition font-bold">
                                +
                            </button>
                        </div>
                        <span class="text-sm text-zlato-black/60">{{ product.inventory }} {% trans "available" %}</span>
                    </div>

                    <!-- Add to Cart Button -->
                    <button type="submit"
                            class="w-full bg-zlato-black text-white py-4 rounded-xl hover:bg-zlato-lime hover:text-zlato-black transition-all duration-300 font-black text-lg transform hover:scale-105 shadow-lg hover:shadow-xl">
                        {% trans "Add to Cart" %}
                    </button>
                </form>
                {% else %}
                <button disabled
                        class="w-full bg-gray-300 text-gray-500 py-4 rounded-xl cursor-not-allowed font-black text-lg">
                    {% trans "Out of Stock" %}
                </button>
                {% endif %}
            </div>

            <!-- Full Description -->
            <div class="bg-zlato-pink-light rounded-xl p-6 border-2 border-zlato-pink">
                <h2 class="text-2xl font-black text-zlato-black mb-4">{% trans "About This Product" %}</h2>
                <div class="text-zlato-black/80 leading-relaxed whitespace-pre-line">
                    {% if language == 'bg' and product.description_bg %}
                        {{ product.description_bg }}
                    {% else %}
                        {{ product.description }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Related Products / Back to Shop -->
    <div class="mt-16 text-center fade-in">
        <a href="{% url 'homepage' %}"
           class="inline-block bg-white text-zlato-black border-2 border-zlato-black px-8 py-3 rounded-lg hover:bg-zlato-black hover:text-white transition-all duration-300 font-bold">
            ‚Üê {% trans "Back to Shop" %}
        </a>
    </div>
</section>

<!-- Image Gallery Script -->
<script>
function changeImage(newSrc) {
    const mainImage = document.getElementById('mainImage');
    if (mainImage) {
        mainImage.style.opacity = '0';
        setTimeout(() => {
            mainImage.src = newSrc;
            mainImage.style.opacity = '1';
        }, 150);
    }
}
</script>

<style>
#mainImage {
    transition: opacity 0.3s ease-in-out;
}
</style>
{% endblock %}
